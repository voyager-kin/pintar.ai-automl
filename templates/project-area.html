<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Project</title>
        <meta name="description" content="Description">
        <meta name="keywords" content="social content network, social network">
        <meta name="robots" content="index">
        <meta name="author" content="Author">
        <meta name="designer" content="Designer">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    
        <!-- Facebook -->
        <meta property="og:title" content="Title">
        <meta property="og:site_name" content="Site Name">
        <meta property="og:description" content="Description">
        <meta property="og:url" content="/_url">
        <meta property="og:image" content='{{ url_for("static", filename="assets/images/img-to-share.jpg") }}'>
        <meta property="og:type" content="website">
    
        <!-- Google+ -->
        <meta itemprop="name" content="Name">
        <meta itemprop="description" content="Description">
        <meta itemprop="image" content='{{ url_for("static", filename="assets/images/img-to-share.jpg") }}'>
    
        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="Title">
        <meta name="twitter:description" content="Description">
        <meta name="twitter:site" content="@twitteraccount">
        <meta name="twitter:creator" content="@qubicle_id">
        <meta name="twitter:url" content="/_url">
        <meta name="twitter:image" content='{{ url_for("static", filename="assets/images/img-to-share.jpg") }}'>
    
        <!-- Favicons -->
        <link rel="apple-touch-icon" href='{{ url_for("static", filename="assets/images/favicons/apple-touch-icon-57x57.png") }}' sizes="57x57">
        <link rel="apple-touch-icon" href='{{ url_for("static", filename="assets/images/favicons/apple-touch-icon-60x60.png") }}' sizes="60x60">
        <link rel="apple-touch-icon" href='{{ url_for("static", filename="assets/images/favicons/apple-touch-icon-72x72.png") }}' sizes="72x72">
        <link rel="apple-touch-icon" href='{{ url_for("static", filename="assets/images/favicons/apple-touch-icon-76x76.png") }}' sizes="76x76">
        <link rel="apple-touch-icon" href='{{ url_for("static", filename="assets/images/favicons/apple-touch-icon-114x114.png") }}' sizes="114x114">
        <link rel="icon" type="image/png" href='{{ url_for("static", filename="assets/images/favicons/favicon-16x16.png") }}' sizes="16x16">
        <link rel="icon" type="image/png" href='{{ url_for("static", filename="assets/images/favicons/favicon-32x32.png") }}' sizes="32x32">
        <link rel="icon" type="image/png" href='{{ url_for("static", filename="assets/images/favicons/favicon-96x96.png") }}' sizes="96x96">
        <link rel="shortcut icon" type="image/ico" href='{{ url_for("static", filename="assets/images/favicons/favicon.ico") }}'>
        <link rel="manifest" href='{{ url_for("static", filename="assets/images/favicons/manifest.json") }}'>
        <meta name="theme-color" content="#fafafa">
    
        <!-- Styles -->
        <link rel="stylesheet" type="text/css" media="screen" href='{{ url_for("static", filename="assets/css/style.css") }}'>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

        <!-- tes tambahan -->
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"> -->
        <!--  -->

        <!-- Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Sarabun:400,800" rel="stylesheet">
    </head>
    <body oncontextmenu="return false;" >
        <nav class="navbar navbar-bisnis">
            <div class="container-fluid">
              <!-- Brand and toggle get grouped for better mobile display -->
              <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Datalabs@<span>pintar.ai</span></a>
              </div>
          
              <!-- Collect the nav links, forms, and other content for toggling -->
              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                  <!-- <li><a href="#">Project List</a></li> -->
                  <li><a href="#" class="btn-mode" data-toggle="modal" data-target="#modal-new-project">New Project</a></li>
                  <li><a href="#" onclick="logout()">Logout</a></li>
                  <!-- <li><a href="/logout" onclick="logout()">Logout</a></li> -->
                  <!--<li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      <li><a href="#">Action</a></li>
                      <li><a href="#">Another action</a></li>
                      <li><a href="#">Something else here</a></li>
                      <li role="separator" class="divider"></li>
                      <li><a href="#">Separated link</a></li>
                    </ul>
                  </li>-->
                </ul>
              </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
          </nav>
        <div class="header-box"></div>
        <div class="container">
            <div class="main-container">
                <div class="row">
                    <div class="col-md-2">
                        <div class="profile-user">
                            <img src='{{ url_for("static", filename="assets/img/profile.png") }}'>
                            <h3>{{ session['name']}}</h3>
                            
                            <p>{{ session['user_id']}}</p>
                        </div>
                    </div>
                    <div class="col-md-10">
                        <div class="title-admin">
                            <h2>Hello!.</h2>
                            <h3>Welcome Back</h3>
                        </div>
                        <div class="usage-total">
                            <div class="usage">
                                <h2>Total Usage</h2>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3>CPU Core</h3>
                                        <h1><span>{{ user_data['quota']['core_used'] }}</span>/{{ user_data['quota']['core_left'] }} Core</h1>
                                    </div>
                                    <div class="col-md-6">
                                        <h3>Memory</h3>
                                        <h1><span>{{ user_data['quota']['mem_used'] }}</span>/{{ user_data['quota']['mem_left'] }} MB</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="list-projects">
                            <div class="title-p">
                                <h2>My Project</h2>
                                <span></span>
                            </div>
                            <div class="project-box">
                                {% set i = 1 %}
                                <div class="row">
                                {% for record in data_user %}
                                        <div class="col-md-4" >
                                            <div class="card-project">
                                                    <h4>{{ record[4] }}</h4>
                                                    <p class="status" id="showcode">Status <span class="active" id="status{{ loop.index }}"></span></p>
                                                    <p class="desc">{{ record[5] }}</p>
                                                    <a href="{{ url_for('open_project', project_name=record[4], session_name=session['session_name']) | safe }}" class="btn-open">Open Project</a>
                                            </div>
                                        </div> 
                               
                                {% endfor %}
                            </div>
                           <!--  <ul class="pagination">
                                        <li class="active"><a href="#">1</a></li>
                                        <li><a href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li><a href="#">4</a></li>
                                        <li><a href="#">5</a></li>
                                    </ul>
                             -->
                            </div>
                            {{ pagination.links }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

        <!-- Modal Create Project-->
        <div class="modal fade" id="modal-new-project" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Create New Project</h4>
                    </div>
                    <div class="modal-body">
                        <div class="new-project-form">
                            <form id="create_session" action='/create_project' method="POST">
                                <div class="input-grp">
                                    <label>Project name</label>
                                    <input id="project_name" name="project_name" type="text" placeholder="Project name" required="">
                                </div>
                                <div class="input-grp">
                                    <label>Project Description</label>
                                    <textarea id="project_description" name="project_description" type="text" placeholder="Project Description"></textarea>
                                </div>
                                <div class="input-grp">
                                    <label>CPU Capacity</label>
                                    <select id="num_of_core" class="single-select" name="num_of_core" style="width: 100%">
                                        <option value="0" hidden>Select Core</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="4">4</option>
                                        <option value="8">8</option>
                                        <option value="16">16</option>
                                        <option value="32">32</option>
                                    </select>
                                </div>
                                <div class="input-grp">
                                    <label>Memory Capacity</label>
                                    <input id="num_of_memory" type="number" name="num_of_memory" style="width: 100%">
                                    
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                    <button id="button_submit" class="btn btn-success">Create Project</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Scripts -->
        <script src='{{ url_for("static", filename="assets/js/libs.js") }}'></script>
        <script src='{{ url_for("static", filename="assets/js/app.js") }}'></script>
        
    </body>
</html>
<script type="text/javascript">
    $( "ul" ).addClass( "pagination" );
    history.pushState(null, null, location.href);
        window.onpopstate = function () {
            history.go(1);
        };
</script>
<script type="text/javascript">
    $(document).ready(function(){
        $("#button_submit").click(function(){
            // alert('halooo');

            if($('#project_name').val() == ""){
                alert("Project name still empty.");
            }else if($('#project_description').val() == ""){
                alert("Project description still empty.");
            }else if($('#num_of_core').val() == "0"){
                alert("CPU Capacity still empty.");
            }else if($('#num_of_memory').val() == ""){
                alert("Memory Capacity still empty");
            }else{
                $("#create_session").submit();
            }
            
        });
    });

    $("input#project_name").on({
        keydown: function(e) {
            if (e.which === 32)
              return false;
        },
      change: function() {
            this.value = this.value.replace(/\s/g, "");
        }
    });
</script>

<script type="text/javascript">
    window.onload = function() {
        {% for record in data_user %}
            get_session("{{ record[0]}}","{{ record[6]}}","{{ record[4]}}","{{loop.index}}");
        {% endfor %}        
    }

   function get_session(user_id, livy_id, project_name, loop){
        // livy_id = getCurrentSession();
        url = gateway + "check_session/" + user_id + "/" + livy_id + "/" + project_name;

        $.ajax({
        url: url,
        type: 'GET',
        dataType: 'json', // added data type

        success: function(result) {
            try{
                responseGetSession(result, loop);    
            }catch (err){
                get_session(user_id, livy_id, project_name, loop);                
            };                    
        },
        error: function(error) {
            ////console.log(error);
            responseToDoError(error, toDo);            
        }
    });
   }

   function responseGetSession(result, loop){
        var obj1 = JSON.stringify(result);
        var obj2 = JSON.parse(obj1);
        var obj3 = JSON.parse(obj2.result.description);
        ////console.log(obj2.result.code);

        if (obj2.result.code != 'livy-0'){
            if (obj2.result.code == 'livy-5'){
                $('#status'+loop).text('Session not found');
                $('#status'+loop).css("color", "red");                 
            }
        }
        else{
            if(obj3.state == 'dead'){
                $('#status'+loop).css("color", "red");
            }
            else{

            }
            $('#status'+loop).text(obj3.state);
        }
   }
</script>